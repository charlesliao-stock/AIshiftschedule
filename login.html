<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å…¥ - è­·ç†ç«™ AI æ’ç­ç³»çµ±</title>
    
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <style>
        .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; }
        .login-card { background: white; border-radius: 16px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); padding: 48px; width: 100%; max-width: 420px; }
        .login-header { text-align: center; margin-bottom: 40px; }
        .login-logo { width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 36px; color: white; }
        .login-title { font-size: 28px; font-weight: 700; color: #1a1a1a; margin: 0 0 8px 0; }
        .login-subtitle { font-size: 14px; color: #666; }
        .form-group { margin-bottom: 24px; }
        .form-label { display: block; font-size: 14px; font-weight: 600; color: #333; margin-bottom: 8px; }
        .form-input { width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px; transition: all 0.3s; box-sizing: border-box; }
        .form-input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .form-input.error { border-color: #ef4444; }
        .error-message { color: #ef4444; font-size: 13px; margin-top: 6px; display: none; }
        .error-message.show { display: block; }
        .btn-login { width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-login:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3); }
        .btn-login:active { transform: translateY(0); }
        .btn-login:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .login-footer { margin-top: 32px; text-align: center; font-size: 13px; color: #666; }
        .demo-info { margin-top: 24px; padding: 16px; background: #f0f4ff; border-radius: 8px; font-size: 13px; line-height: 1.6; }
        .demo-info strong { color: #667eea; }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">ğŸ¥</div>
                <h1 class="login-title">è­·ç†ç«™æ’ç­ç³»çµ±</h1>
                <p class="login-subtitle">AI æ™ºèƒ½æ’ç­è§£æ±ºæ–¹æ¡ˆ</p>
            </div>
            
            <form id="login-form">
                <div class="form-group">
                    <label class="form-label" for="email">é›»å­éƒµä»¶</label>
                    <input type="email" id="email" class="form-input" placeholder="è«‹è¼¸å…¥é›»å­éƒµä»¶" required autocomplete="email">
                    <div class="error-message" id="email-error"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="password">å¯†ç¢¼</label>
                    <input type="password" id="password" class="form-input" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" required autocomplete="current-password">
                    <div class="error-message" id="password-error"></div>
                </div>
                
                <button type="submit" class="btn-login" id="login-btn">ç™»å…¥</button>
            </form>
            
            <div class="demo-info">
                <strong>ğŸ¯ æ¸¬è©¦å¸³è™Ÿ:</strong><br>
                ç®¡ç†è€…: admin@hospital.com / password123<br>
                (è«‹ç¢ºèªå·²åœ¨ Firebase å¾Œå°å»ºç«‹æ­¤å¸³è™Ÿ)
            </div>
            
            <div class="login-footer">Â© 2025 è­·ç†ç«™ AI æ’ç­ç³»çµ± v1.0</div>
        </div>
    </div>

    <div id="toast-container" class="toast-container"></div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script type="module">
        import { FirebaseService } from './js/services/firebase.service.js';
        import { Auth } from './js/core/auth.js';
        import { Notification } from './js/components/notification.js';

        // ç™»å…¥é é¢é‚è¼¯
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // åˆå§‹åŒ–é€šçŸ¥å…ƒä»¶ (å¦‚æœé‚„æ²’åˆå§‹åŒ–)
                Notification.init();

                // åˆå§‹åŒ– Firebase
                await FirebaseService.init();
                console.log("Firebase initialized on login page");
                
                // æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
                // Auth.init å…§éƒ¨æœƒè®€å–æœ¬åœ°å„²å­˜
                await Auth.init();
                const currentUser = Auth.getCurrentUser();
                
                if (currentUser) {
                    window.location.href = 'index.html';
                    return;
                }
            } catch (error) {
                console.error("Login page init error:", error);
                Notification.error("ç³»çµ±åˆå§‹åŒ–å¤±æ•—");
            }
            
            // ç™»å…¥è¡¨å–®è™•ç†
            const loginForm = document.getElementById('login-form');
            const loginBtn = document.getElementById('login-btn');
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // æ¸…é™¤éŒ¯èª¤è¨Šæ¯
                document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));
                document.querySelectorAll('.form-input').forEach(el => el.classList.remove('error'));
                
                const email = emailInput.value.trim();
                const password = passwordInput.value;
                
                if (!email) {
                    showError('email', 'è«‹è¼¸å…¥é›»å­éƒµä»¶');
                    return;
                }
                if (!password) {
                    showError('password', 'è«‹è¼¸å…¥å¯†ç¢¼');
                    return;
                }
                
                // é–å®šæŒ‰éˆ•
                loginBtn.disabled = true;
                loginBtn.textContent = 'ç™»å…¥ä¸­...';
                
                try {
                    const user = await Auth.login(email, password);
                    
                    if (user) {
                        Notification.success('ç™»å…¥æˆåŠŸ!');
                        setTimeout(() => window.location.href = 'index.html', 500);
                    }
                } catch (error) {
                    console.error('ç™»å…¥å¤±æ•—:', error);
                    Notification.error(error.message || 'ç™»å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥å¸³è™Ÿå¯†ç¢¼');
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'ç™»å…¥';
                }
            });
            
            function showError(field, message) {
                const input = document.getElementById(field);
                const error = document.getElementById(`${field}-error`);
                input.classList.add('error');
                error.textContent = message;
                error.classList.add('show');
            }
        });
    </script>
</body>
</html>