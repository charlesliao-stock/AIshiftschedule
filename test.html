<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è­·ç†ç«™ AI æ’ç­ç³»çµ± - Week 1-5 æ•´åˆæ¸¬è©¦</title>
    
    <!-- è¼‰å…¥ç³»çµ±æª”æ¡ˆ - æŒ‰ç…§ index.html çš„é †åº -->
    
    <!-- ç¬¬ä¸‰æ–¹åº« -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.10/dayjs.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- 1. é…ç½®æª”æ¡ˆ -->
    <script src="js/config/constants.js"></script>
    <script src="js/config/firebase.config.js"></script>
    <script src="js/config/api.config.js"></script>
    
    <!-- 2. æ ¸å¿ƒæ¨¡çµ„ -->
    <script src="js/core/utils.js"></script>
    <script src="js/core/storage.js"></script>
    <script src="js/core/auth.js"></script>
    <script src="js/core/router.js"></script>
    
    <!-- 3. æœå‹™å±¤ -->
    <script src="js/services/firebase.service.js"></script>
    <script src="js/services/sheets.service.js"></script>
    <script src="js/services/unit.service.js"></script>
    <script src="js/services/settings.service.js"></script>
    <script src="js/services/schedule.service.js"></script>
    <script src="js/services/pre-schedule.service.js"></script>
    
    <!-- 4. å…ƒä»¶ -->
    <script src="js/components/loading.js"></script>
    <script src="js/components/notification.js"></script>
    <script src="js/components/navbar.js"></script>
    <script src="js/components/sidebar.js"></script>
    <script src="js/components/modal.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left-color: #ffc107;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .test-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .test-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .test-item {
            padding: 12px;
            border-left: 3px solid;
            margin-bottom: 10px;
            border-radius: 0 4px 4px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
        }

        .test-item.success {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .test-item.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        .test-item.warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }

        .test-name {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
        }

        .test-status {
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 600;
        }

        .status-success {
            background: #28a745;
            color: white;
        }

        .status-error {
            background: #dc3545;
            color: white;
        }

        .status-warning {
            background: #ffc107;
            color: #000;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #6c757d;
        }

        .details-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .details-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .detail-item {
            padding: 10px;
            border-bottom: 1px solid #e9ecef;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: bold;
            color: #495057;
            margin-right: 10px;
        }

        .detail-value {
            color: #6c757d;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            background: #667eea;
            color: white;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .control-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin-top: 10px;
        }

        .recommendation {
            background: #e7f3ff;
            border-left: 4px solid #0066cc;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .recommendation h4 {
            color: #0066cc;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª è­·ç†ç«™ AI æ’ç­ç³»çµ± - Week 1-5 æ•´åˆæ¸¬è©¦</h1>
            <p>å®Œæ•´ç³»çµ±æª”æ¡ˆè¼‰å…¥èˆ‡åŠŸèƒ½æª¢æŸ¥</p>
        </div>

        <div id="overallStatus"></div>

        <!-- çµ±è¨ˆå€ -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" style="color: #28a745;" id="passedCount">0</div>
                <div class="stat-label">âœ“ é€šé</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: #dc3545;" id="failedCount">0</div>
                <div class="stat-label">âœ— å¤±æ•—</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: #ffc107;" id="warningCount">0</div>
                <div class="stat-label">âš  è­¦å‘Š</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">ç¸½æ¸¬è©¦æ•¸</div>
            </div>
        </div>

        <div class="control-section">
            <button class="btn" onclick="location.reload()">ğŸ”„ é‡æ–°åŸ·è¡Œæ¸¬è©¦</button>
        </div>

        <!-- æ¸¬è©¦çµæœ -->
        <div class="test-grid" id="testResults"></div>

        <!-- è©³ç´°è³‡è¨Š -->
        <div class="details-section">
            <h3>ğŸ“‹ ç³»çµ±ç’°å¢ƒè³‡è¨Š</h3>
            <div id="systemInfo"></div>
        </div>

        <!-- å»ºè­° -->
        <div id="recommendations"></div>
    </div>

    <script>
        // æ¸¬è©¦çµæœçµ±è¨ˆ
        const stats = {
            passed: 0,
            failed: 0,
            warning: 0,
            total: 0
        };

        // æ¸¬è©¦å®šç¾©
        const testCategories = {
            'é…ç½®æª”æ¡ˆ (Config)': [
                { name: 'CONSTANTS', check: () => typeof window.CONSTANTS !== 'undefined', critical: true },
                { name: 'FIREBASE_CONFIG', check: () => typeof window.FIREBASE_CONFIG !== 'undefined', critical: true },
                { name: 'API_CONFIG', check: () => typeof window.API_CONFIG !== 'undefined', critical: true }
            ],
            'æ ¸å¿ƒæ¨¡çµ„ (Core)': [
                { name: 'Utils', check: () => typeof window.Utils !== 'undefined', critical: true },
                { name: 'Storage', check: () => typeof window.Storage !== 'undefined', critical: true },
                { name: 'Auth', check: () => typeof window.Auth !== 'undefined', critical: true },
                { name: 'Router', check: () => typeof window.Router !== 'undefined', critical: false }
            ],
            'æœå‹™å±¤ (Services)': [
                { name: 'FirebaseService', check: () => typeof window.FirebaseService !== 'undefined', critical: true },
                { name: 'SheetsService', check: () => typeof window.SheetsService !== 'undefined', critical: true },
                { name: 'UnitService', check: () => typeof window.UnitService !== 'undefined', critical: false },
                { name: 'SettingsService', check: () => typeof window.SettingsService !== 'undefined', critical: false },
                { name: 'ScheduleService', check: () => typeof window.ScheduleService !== 'undefined', critical: false },
                { name: 'PreScheduleService', check: () => typeof window.PreScheduleService !== 'undefined', critical: false }
            ],
            'UI å…ƒä»¶ (Components)': [
                { name: 'Loading', check: () => typeof window.Loading !== 'undefined', critical: false },
                { name: 'Notification', check: () => typeof window.Notification !== 'undefined' || typeof window.Toast !== 'undefined', critical: false },
                { name: 'Navbar', check: () => typeof window.Navbar !== 'undefined', critical: false },
                { name: 'Sidebar', check: () => typeof window.Sidebar !== 'undefined', critical: false },
                { name: 'Modal', check: () => typeof window.Modal !== 'undefined', critical: false }
            ],
            'å¤–éƒ¨ä¾è³´ (Dependencies)': [
                { name: 'Firebase', check: () => typeof firebase !== 'undefined', critical: true },
                { name: 'dayjs', check: () => typeof dayjs !== 'undefined', critical: false }
            ]
        };

        // åŸ·è¡Œæ¸¬è©¦
        function runTests() {
            const resultsContainer = document.getElementById('testResults');
            const recommendations = [];

            for (const [category, tests] of Object.entries(testCategories)) {
                const card = document.createElement('div');
                card.className = 'test-card';
                
                const title = document.createElement('h3');
                title.textContent = category;
                card.appendChild(title);

                tests.forEach(test => {
                    stats.total++;
                    const result = test.check();
                    const item = document.createElement('div');
                    
                    if (result) {
                        stats.passed++;
                        item.className = 'test-item success';
                        item.innerHTML = `
                            <div class="test-name">${test.name}</div>
                            <div class="test-status status-success">âœ“ é€šé</div>
                        `;
                    } else if (test.critical) {
                        stats.failed++;
                        item.className = 'test-item error';
                        item.innerHTML = `
                            <div class="test-name">${test.name} (å¿…è¦)</div>
                            <div class="test-status status-error">âœ— å¤±æ•—</div>
                        `;
                        recommendations.push({
                            type: 'error',
                            item: test.name,
                            message: `${test.name} æ˜¯å¿…è¦æ¨¡çµ„ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆæ˜¯å¦æ­£ç¢ºè¼‰å…¥`
                        });
                    } else {
                        stats.warning++;
                        item.className = 'test-item warning';
                        item.innerHTML = `
                            <div class="test-name">${test.name} (é¸ç”¨)</div>
                            <div class="test-status status-warning">âš  ç¼ºå¤±</div>
                        `;
                    }
                    
                    card.appendChild(item);
                });

                resultsContainer.appendChild(card);
            }

            updateStats();
            showSystemInfo();
            showRecommendations(recommendations);
            showOverallStatus();
        }

        // æ›´æ–°çµ±è¨ˆ
        function updateStats() {
            document.getElementById('passedCount').textContent = stats.passed;
            document.getElementById('failedCount').textContent = stats.failed;
            document.getElementById('warningCount').textContent = stats.warning;
            document.getElementById('totalCount').textContent = stats.total;
        }

        // é¡¯ç¤ºæ•´é«”ç‹€æ…‹
        function showOverallStatus() {
            const statusDiv = document.getElementById('overallStatus');
            const criticalFailed = stats.failed;
            const percentage = Math.round((stats.passed / stats.total) * 100);

            if (criticalFailed === 0) {
                statusDiv.innerHTML = `
                    <div class="alert alert-success">
                        <strong>âœ“ æ¸¬è©¦é€šéï¼</strong> æ‰€æœ‰å¿…è¦æ¨¡çµ„éƒ½å·²æ­£ç¢ºè¼‰å…¥ (${percentage}%)
                        ${stats.warning > 0 ? `<br><small>æ³¨æ„ï¼šæœ‰ ${stats.warning} å€‹é¸ç”¨æ¨¡çµ„æœªè¼‰å…¥ï¼Œä¸å½±éŸ¿æ ¸å¿ƒåŠŸèƒ½</small>` : ''}
                    </div>
                `;
            } else {
                statusDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <strong>âœ— æ¸¬è©¦å¤±æ•—ï¼</strong> æœ‰ ${criticalFailed} å€‹å¿…è¦æ¨¡çµ„æœªæ­£ç¢ºè¼‰å…¥<br>
                        <small>å®Œæˆåº¦ï¼š${percentage}% - è«‹æŸ¥çœ‹ä¸‹æ–¹å»ºè­°é€²è¡Œä¿®æ­£</small>
                    </div>
                `;
            }
        }

        // é¡¯ç¤ºç³»çµ±è³‡è¨Š
        function showSystemInfo() {
            const infoDiv = document.getElementById('systemInfo');
            const info = [
                { label: 'ç€è¦½å™¨', value: navigator.userAgent },
                { label: 'ç•¶å‰ç¶²å€', value: window.location.href },
                { label: 'Firebase ç‹€æ…‹', value: typeof firebase !== 'undefined' ? 'å·²è¼‰å…¥' : 'æœªè¼‰å…¥' },
                { label: 'CONSTANTS å¯ç”¨', value: typeof CONSTANTS !== 'undefined' ? 'æ˜¯' : 'å¦' },
                { label: 'Window å…¨åŸŸç‰©ä»¶æ•¸é‡', value: Object.keys(window).length }
            ];

            info.forEach(item => {
                const div = document.createElement('div');
                div.className = 'detail-item';
                div.innerHTML = `
                    <span class="detail-label">${item.label}:</span>
                    <span class="detail-value">${item.value}</span>
                `;
                infoDiv.appendChild(div);
            });
        }

        // é¡¯ç¤ºå»ºè­°
        function showRecommendations(recommendations) {
            const recDiv = document.getElementById('recommendations');
            
            if (recommendations.length === 0) {
                recDiv.innerHTML = `
                    <div class="recommendation">
                        <h4>âœ“ å¤ªå¥½äº†ï¼</h4>
                        <p>æ‰€æœ‰å¿…è¦æ¨¡çµ„éƒ½å·²æ­£ç¢ºè¼‰å…¥ï¼Œæ‚¨å¯ä»¥ç¹¼çºŒä½¿ç”¨ç³»çµ±ã€‚</p>
                    </div>
                `;
                return;
            }

            let html = '<div class="recommendation">';
            html += '<h4>ğŸ”§ ä¿®æ­£å»ºè­°</h4>';
            html += '<ol>';
            
            recommendations.forEach(rec => {
                html += `<li style="margin: 10px 0;"><strong>${rec.item}:</strong> ${rec.message}</li>`;
            });
            
            html += '</ol>';
            html += '<h4 style="margin-top: 20px;">æª¢æŸ¥æ­¥é©Ÿï¼š</h4>';
            html += '<ol>';
            html += '<li>é–‹å•Ÿç€è¦½å™¨é–‹ç™¼è€…å·¥å…· (F12)</li>';
            html += '<li>æŸ¥çœ‹ Console æ¨™ç±¤ï¼Œç¢ºèªæœ‰ç„¡ç´…è‰²éŒ¯èª¤è¨Šæ¯</li>';
            html += '<li>æŸ¥çœ‹ Network æ¨™ç±¤ï¼Œç¢ºèªæ‰€æœ‰ .js æª”æ¡ˆéƒ½æˆåŠŸè¼‰å…¥ (200 ç‹€æ…‹)</li>';
            html += '<li>ç¢ºèªæª”æ¡ˆè·¯å¾‘æ­£ç¢ºï¼ˆç›¸å°æ–¼ HTML æª”æ¡ˆä½ç½®ï¼‰</li>';
            html += '<li>ç¢ºèª JavaScript æª”æ¡ˆä¸­çš„è®Šæ•¸/é¡åˆ¥åç¨±æ­£ç¢ºåŒ¯å‡ºåˆ° window ç‰©ä»¶</li>';
            html += '</ol>';
            
            html += '<h4 style="margin-top: 20px;">å¸¸è¦‹å•é¡Œï¼š</h4>';
            html += '<div class="code-block">';
            html += '// ç¢ºä¿åœ¨æ¯å€‹ Service æª”æ¡ˆæœ€å¾Œæœ‰åŒ¯å‡ºåˆ° window\n';
            html += 'if (typeof window !== \'undefined\') {\n';
            html += '    window.YourServiceName = YourServiceName;\n';
            html += '}\n';
            html += '</div>';
            html += '</div>';
            
            recDiv.innerHTML = html;
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œæ¸¬è©¦
        window.addEventListener('load', () => {
            // ç­‰å¾…æ‰€æœ‰è…³æœ¬è¼‰å…¥
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html>